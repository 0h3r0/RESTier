---
layout: post
title: "2.4 ETag Support"
description: ""
category: "2. Features"
---

RESTier supports ETag starting from version 0.6.

In order to support etag, the entity clr class must have some properties which are marked with [ConcurrencyCheck] attribute, then the properties with this attribute will be used to calculate the etag for concurrency support purpose.

The etag support is divided into two parts,

First part is the "@odata.etag" annotation support, it is part of response body, and will be auto added for any entity type which has properties with ConcurrencyCheck attribute when the request is a single entity or a collection of entity (in collection case, each entity instance will have "@odata.etag" annotation).

Second part is Etag header support, this is only support when operation is against a single entity. Here are the summary of the behavior.

| Operation       | Header          | Etag matched? | Response                    |
|-----------------|-----------------|---------------|-----------------------------|
| Get             | If-Match        | No            | 412(Precondition failed)    |
|                 |                 | Yes           | Return the entity           |
|                 | If-None-Match   | No            | Return the entity           |
|                 |                 | Yes           | 304(Not modified)           |
| Update/Delete   | No header       |               | 428 (Precondition required) |
|                 | If-Match        | No            | 412(Precondition failed)    |
|                 |                 | Yes           | Proceed the operation       |
|                 | If-None-Match   | No            | Proceed the operation       |
|                 |                 | Yes           | 412(Precondition failed)    |

In order to support the get method return the etag header, this configuration is a must,

	config.MessageHandlers.Add(new ETagMessageHandler());

User can define his own message handler to set the etag header in the response.

For both etag annotation and etag header, the algorithm to generate the etag can be replaced, user can create his own etag handler, then set in the config, and default is DefaultODataETagHandler. The code to set customize etag handler is as following,

    IETagHandler eTagHandler = new CustomizedETagHandler();
    config.SetETagHandler(eTagHandler);

For detail end to end examples, refer to end to end test case [TrippinE2EEtagTestCases](https://github.com/OData/RESTier/blob/master/test/ODataEndToEnd/Microsoft.OData.Service.Sample.Tests/TrippinE2EEtagTestCases.cs).

With etag support, the entity can be operated in concurrency mode.
